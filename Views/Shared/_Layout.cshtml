<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - DarkCloud</title>
    <script type="importmap"></script>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/DarkCloud.styles.css" asp-append-version="true" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;900&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Montserrat', Arial, sans-serif;
        background: linear-gradient(135deg, #0f2027 0%, #232526 100%);
        color: #e0e6f7;
        min-height: 100vh;
      }
      .navbar {
        background: linear-gradient(90deg, #181a1b 60%, #232526 100%);
        backdrop-filter: blur(8px);
        box-shadow: 0 0 24px #00fff7a0;
        border-bottom: 2px solid #7c4dff;
      }
      .navbar-brand {
        font-family: 'Orbitron', 'Montserrat', Arial, sans-serif;
        font-size: 2.2rem !important;
        letter-spacing: 2px;
        padding: 0.2em 0.5em;
        background: linear-gradient(90deg, #00fff7 0%, #7c4dff 100%);
        border-radius: 18px;
        box-shadow: 0 0 16px #00fff7a0;
        color: #181a1b !important;
        transition: background 0.2s;
      }
      .logo-multicolor {
        font-size: 2.3rem;
        font-family: 'Orbitron', 'Montserrat', Arial, sans-serif;
        letter-spacing: 2px;
        text-shadow: 0 0 12px #00fff7, 0 2px 8px #7c4dff;
        display: flex;
        align-items: center;
      }
      .navbar-brand .fa-gamepad {
        font-size: 2.2rem;
        color: #00fff7;
        filter: drop-shadow(0 0 8px #7c4dff);
        margin-right: 0.5em;
      }
      .navbar-nav {
        gap: 0.2em;
      }
      .navbar-nav .nav-item {
        display: flex;
        align-items: center;
        height: 48px;
      }
      .navbar-nav .nav-link {
        font-size: 1rem;
        font-weight: 600;
        color: #e0e6f7 !important;
        margin: 0 0.1em;
        letter-spacing: 0.5px;
        padding: 0.5em 1em;
        border-radius: 10px;
        display: flex;
        align-items: center;
        min-width: 0;
        white-space: nowrap;
        transition: background 0.2s, color 0.2s;
      }
      .navbar-nav .nav-link:hover, .navbar-nav .nav-link.active {
        color: #00fff7 !important;
        background: #232526;
        text-shadow: 0 0 8px #00fff7a0;
      }
      .navbar-nav .dropdown-menu {
        min-width: 180px;
      }
      .navbar-toggler {
        border-radius: 10px;
        border: 2px solid #7c4dff;
      }
      .dropdown-menu {
        background: #181a1b;
        border: 2px solid #7c4dff;
        border-radius: 12px;
      }
      .dropdown-item {
        color: #e0e6f7;
        font-weight: 500;
      }
      .dropdown-item:hover {
        background: linear-gradient(90deg, #00fff7 0%, #7c4dff 100%);
        color: #181a1b;
      }
      .btn-outline-light, .btn-outline-primary {
        border-radius: 12px;
        font-weight: bold;
        letter-spacing: 1px;
      }
      .form-control {
        border-radius: 12px;
        background: #232526;
        color: #fff;
        border: 2px solid #00fff7;
      }
      .form-control:focus {
        border-color: #7c4dff;
        box-shadow: 0 0 8px #7c4dff80;
      }
      .container, .container-fluid {
        padding-top: 1.5rem;
        padding-bottom: 1.5rem;
      }
      main {
        padding-top: 2.5rem;
        padding-bottom: 2.5rem;
      }
      footer {
        background: linear-gradient(90deg, #181a1b 60%, #232526 100%);
        border-top: 2px solid #7c4dff;
        color: #e0e6f7;
        font-family: 'Montserrat', Arial, sans-serif;
        font-size: 1.1rem;
      }
      footer h5 {
        font-family: 'Orbitron', 'Montserrat', Arial, sans-serif;
        color: #00fff7;
        font-size: 1.3rem;
        letter-spacing: 1px;
      }
      footer a {
        color: #7c4dff;
        text-decoration: underline;
      }
      footer a:hover {
        color: #00fff7;
      }
    </style>
</head>
<body>
    <!-- Navbar DarkCloud con iconos -->
    @using Microsoft.AspNetCore.Identity
    @inject SignInManager<Usuario> SignInManager
    @inject UserManager<Usuario> UserManager

    @{
        string? usuarioNombre = null;
        string? usuarioRol = null;
        if (User.Identity != null && User.Identity.IsAuthenticated)
        {
            var usuario = await UserManager.GetUserAsync(User);
            usuarioNombre = usuario?.Nombre ?? User.Identity.Name;
            usuarioRol = usuario?.Rol;
        }
    }
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow">
      <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center fw-bold" href="/">
          <i class="fas fa-gamepad me-2"></i>
          <span class="logo-multicolor">
            <span style="color:#ff5252">D</span><span style="color:#ffd600">a</span><span style="color:#69f0ae">r</span><span style="color:#40c4ff">k</span><span style="color:#7c4dff">C</span><span style="color:#ff4081">l</span><span style="color:#ffab40">o</span><span style="color:#00e676">u</span><span style="color:#18ffff">d</span>
          </span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            @if (User.Identity == null || !User.Identity.IsAuthenticated) {
              <li class="nav-item">
                <a class="nav-link text-white" href="/">
                  <i class="fas fa-home me-1"></i> Inicio
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="/Home/Catalogo">
                  <i class="fas fa-th-large me-1"></i> Catálogo
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="/Home/Catalogo?tipo=Oferta">
                  <i class="fas fa-tags me-1"></i> Ofertas
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="/Home/Catalogo?novedades=1">
                  <i class="fas fa-bolt me-1"></i> Novedades
                </a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-white" href="#" id="generosDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fas fa-gamepad me-1"></i> Géneros
                </a>
                <ul class="dropdown-menu" aria-labelledby="generosDropdown">
                  <li><a class="dropdown-item" href="/Home/Catalogo?genero=Acción"><i class="fas fa-fist-raised me-1"></i> Acción</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?genero=Aventura"><i class="fas fa-hat-wizard me-1"></i> Aventura</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?genero=Deportes"><i class="fas fa-futbol me-1"></i> Deportes</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?genero=RPG"><i class="fas fa-dice-d20 me-1"></i> RPG</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?genero=Estrategia"><i class="fas fa-chess me-1"></i> Estrategia</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?genero=Simulación"><i class="fas fa-cogs me-1"></i> Simulación</a></li>
                </ul>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-white" href="#" id="plataformasDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fas fa-laptop me-1"></i> Plataformas
                </a>
                <ul class="dropdown-menu" aria-labelledby="plataformasDropdown">
                  <li><a class="dropdown-item" href="/Home/Catalogo?plataforma=PlayStation"><i class="fab fa-playstation me-1"></i> PlayStation</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?plataforma=Xbox"><i class="fab fa-xbox me-1"></i> Xbox</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?plataforma=Nintendo"><i class="fas fa-gamepad me-1"></i> Nintendo</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?plataforma=PC"><i class="fas fa-desktop me-1"></i> PC</a></li>
                </ul>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="/Account/Login">
                  <i class="fas fa-sign-in-alt me-1"></i> Iniciar Sesión
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="/Account/Register">
                  <i class="fas fa-user-plus me-1"></i> Registrarse
                </a>
              </li>
            } else if (usuarioRol == "Cliente") {
              <li class="nav-item">
                <a class="nav-link text-white" href="/">
                  <i class="fas fa-home me-1"></i> Inicio
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="/Home/Catalogo">
                  <i class="fas fa-th-large me-1"></i> Catálogo
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="/Home/Catalogo?tipo=Oferta">
                  <i class="fas fa-tags me-1"></i> Ofertas
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="/Home/Catalogo?novedades=1">
                  <i class="fas fa-bolt me-1"></i> Novedades
                </a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-white" href="#" id="generosDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fas fa-gamepad me-1"></i> Géneros
                </a>
                <ul class="dropdown-menu" aria-labelledby="generosDropdown">
                  <li><a class="dropdown-item" href="/Home/Catalogo?genero=Acción"><i class="fas fa-fist-raised me-1"></i> Acción</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?genero=Aventura"><i class="fas fa-hat-wizard me-1"></i> Aventura</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?genero=Deportes"><i class="fas fa-futbol me-1"></i> Deportes</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?genero=RPG"><i class="fas fa-dice-d20 me-1"></i> RPG</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?genero=Estrategia"><i class="fas fa-chess me-1"></i> Estrategia</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?genero=Simulación"><i class="fas fa-cogs me-1"></i> Simulación</a></li>
                </ul>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-white" href="#" id="plataformasDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fas fa-laptop me-1"></i> Plataformas
                </a>
                <ul class="dropdown-menu" aria-labelledby="plataformasDropdown">
                  <li><a class="dropdown-item" href="/Home/Catalogo?plataforma=PlayStation"><i class="fab fa-playstation me-1"></i> PlayStation</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?plataforma=Xbox"><i class="fab fa-xbox me-1"></i> Xbox</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?plataforma=Nintendo"><i class="fas fa-gamepad me-1"></i> Nintendo</a></li>
                  <li><a class="dropdown-item" href="/Home/Catalogo?plataforma=PC"><i class="fas fa-desktop me-1"></i> PC</a></li>
                </ul>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white position-relative" href="/Carrito">
                  <i class="fas fa-shopping-cart me-1"></i> Carrito
                  <span id="cart-count-badge" class="badge bg-danger ms-1" style="display:none;position:absolute;top:2px;right:-10px;">0</span>
                </a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle text-white" href="#" id="usuarioDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fas fa-user me-1"></i> @usuarioNombre
                </a>
                <ul class="dropdown-menu" aria-labelledby="usuarioDropdown">
                  <li><a class="dropdown-item" href="/Account/Logout"><i class="fas fa-sign-out-alt me-1"></i> Cerrar sesión</a></li>
                  <li><a class="dropdown-item" href="/Account/Login"><i class="fas fa-exchange-alt me-1"></i> Cambiar de cuenta</a></li>
                </ul>
              </li>
            } else if (usuarioRol == "Administrador") {
              <li class="nav-item">
                <a class="nav-link text-white" href="/Administrador">
                  <i class="fas fa-user-shield me-1"></i> Panel Admin
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link text-white" href="/Account/Logout">
                  <i class="fas fa-sign-out-alt me-1"></i> Cerrar sesión
                </a>
              </li>
            }
          </ul>
        </div>
      </div>
    </nav>
    <!-- Fin Navbar -->
    @if (usuarioRol == "Administrador") {
    <div class="admin-bg d-flex" style="min-height:100vh;">
      <nav class="admin-sidebar bg-dark text-white p-4 d-flex flex-column align-items-start" style="min-width:220px; min-height:100vh; border-radius:0 18px 18px 0; box-shadow:2px 0 8px #0001;">
        <h4 class="mb-4 fw-bold" style="letter-spacing:1px;">Panel Admin</h4>
        <ul class="nav flex-column gap-1 w-100">
          <li class="nav-item"><a class="nav-link text-white @(Context.Request.Path.StartsWithSegments("/Administrador") && Context.Request.Path == "/Administrador" ? "active bg-primary rounded" : "")" href="/Administrador"><i class="fas fa-tachometer-alt me-2"></i>Dashboard</a></li>
          <li class="nav-item"><a class="nav-link text-white @(Context.Request.Path.StartsWithSegments("/Administrador/Productos") ? "active bg-primary rounded" : "")" href="/Administrador/Productos"><i class="fas fa-boxes me-2"></i>Productos</a></li>
          <li class="nav-item"><a class="nav-link text-white @(Context.Request.Path.StartsWithSegments("/Administrador/Usuarios") ? "active bg-primary rounded" : "")" href="/Administrador/Usuarios"><i class="fas fa-users me-2"></i>Usuarios</a></li>
          <li class="nav-item"><a class="nav-link text-white @(Context.Request.Path.StartsWithSegments("/Administrador/HomeHeroConfig") ? "active bg-primary rounded" : "")" href="/Administrador/HomeHeroConfig"><i class="fas fa-cogs me-2"></i>Config. Home</a></li>
          <li class="nav-item mt-3"><a class="nav-link text-white" href="/"><i class="fas fa-store me-2"></i>Volver a la tienda</a></li>
          <li class="nav-item mt-auto"><a class="nav-link text-white" href="/Account/Logout"><i class="fas fa-sign-out-alt me-2"></i>Salir</a></li>
        </ul>
      </nav>
      <main class="flex-fill p-4 bg-light" style="min-height:100vh;">
        <div class="container-fluid">
          @RenderBody()
        </div>
      </main>
    </div>
    } else {
    <div class="container">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>
    }
    @if (!(ViewData["OcultarFooter"] as bool? ?? false))
    {
    <footer class="bg-dark text-white py-5">
      <div class="container">
        <div class="row">
          <!-- Información de la tienda -->
          <div class="col-md-4">
            <h5>Sobre DarkCloud</h5>
            <p>Tu tienda de videojuegos favorita. Encuentra los mejores títulos, ofertas y accesorios para gamers.</p>
            <p>"Explora, juega y domina"</p>
          </div>
          <!-- Enlaces rápidos -->
          <div class="col-md-4">
            <h5>Enlaces rápidos</h5>
            <ul class="list-unstyled">
              <li><a class="text-white" href="/Home/Catalogo">Catálogo</a></li>
              <li><a class="text-white" href="/Home/Catalogo?tipo=Oferta">Ofertas</a></li>
              <li><a class="text-white" href="/Home/Catalogo?novedades=1">Novedades</a></li>
              <li><a class="text-white" href="#">Contacto</a></li>
            </ul>
          </div>
          <!-- Contacto -->
          <div class="col-md-4">
            <h5>Contáctanos</h5>
            <p>Email: <a class="text-white" href="mailto:contacto@darkcloud.com">contacto@darkcloud.com</a></p>
            <p>Teléfono: +1 800 123 456</p>
            <p>Dirección: Calle Gamer 123, Ciudad Virtual</p>
          </div>
        </div>
        <div class="text-center mt-4">
          <p>&copy; 2025 - DarkCloud. Todos los derechos reservados.</p>
        </div>
      </div>
    </footer>
    }
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script>
      // Inicialización robusta de Bootstrap para dropdowns en todas las páginas
      function initDropdowns() {
        document.querySelectorAll('.dropdown-toggle').forEach(function (el) {
          if (!el._dropdownInstance) {
            el._dropdownInstance = new bootstrap.Dropdown(el);
          }
        });
      }
      document.addEventListener('DOMContentLoaded', initDropdowns);
      document.addEventListener('htmx:afterSwap', initDropdowns); // por si usas htmx/ajax

      // Mostrar el badge del carrito con la suma real de cantidades desde localStorage
      (function() {
        try {
          let email = (window.getEmailActivo && typeof window.getEmailActivo === 'function') ? window.getEmailActivo() : (sessionStorage.getItem('ultimoEmailLogin') || localStorage.getItem('emailActivo') || '');
          let carrito = [];
          if(email) {
            carrito = JSON.parse(localStorage.getItem('carrito_' + email)) || [];
          }
          let count = carrito.reduce((acc, p) => acc + (p.cantidad || 1), 0);
          const badge = document.getElementById('cart-count-badge');
          if (badge) {
            badge.textContent = count;
            badge.style.display = count > 0 ? '' : 'none';
          }
          sessionStorage.setItem('cartCount', count);
        } catch {}
      })();
    </script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
<style>
  .admin-sidebar .nav-link.active {
    background: #0d6efd !important;
    color: #fff !important;
    font-weight: bold;
  }
  .admin-sidebar .nav-link {
    transition: background 0.2s, color 0.2s;
  }
  .admin-sidebar .nav-link:hover {
    background: #0d6efd22;
    color: #fff;
  }
  .admin-bg {
    background: linear-gradient(120deg, #f8fafc 60%, #e3e6f3 100%);
  }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
